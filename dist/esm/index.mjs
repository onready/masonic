function e(){return(e=Object.assign||function(e){for(var t=1;arguments.length>t;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e}).apply(this,arguments)}function t(e,t){function i(){n(0)}void 0===e&&(e=0),void 0===t&&(t=12);var o=M(t),[r,n]=g(0),a=x(0);return C(()=>{1===a.current&&n(1);var e=b(i,40+1e3/t);return a.current=1,()=>z(e)},[t,o]),{scrollTop:Math.max(0,o-e),isScrolling:r}}function i(){var e=g(B)[1];return x(()=>e({})).current}function o(e){var{positioner:t,resizeObserver:o,items:n,as:a="div",id:s,className:l,style:h,role:v="grid",tabIndex:f=0,containerRef:u,itemAs:d="div",itemStyle:c,itemHeightEstimate:m=300,itemKey:p=r,overscanBy:P=2,scrollTop:g,isScrolling:x,height:R,render:y,onRender:L}=e,w=0,M=void 0,b=i(),z=J(t,o),T=n.length,{columnWidth:I,columnCount:k,range:O,estimateHeight:W,size:j,shortestColumn:S}=t,A=j(),B=S(),q=[],Q=v+"item",U=H(L),V=g+(P*=R),X=V>B&&T>A;if(O(Math.max(0,g-P/2),V,(e,t,i)=>{var o=n[e],r=p(o,e),a={top:i,left:t,width:I,writingMode:"horizontal-tb",position:"absolute"};q.push(E(d,{key:r,ref:z(e),role:Q,style:"object"==typeof c&&null!==c?Object.assign({},a,c):a},G(y,e,o,I))),void 0===M?(w=e,M=e):(w=Math.min(w,e),M=Math.max(M,e))}),X)for(var Y=Math.min(T-A,Math.ceil((g+P-B)/m*k)),Z=A,$=D(I);A+Y>Z;Z++){var _=n[Z],ee=p(_,Z);q.push(E(d,{key:ee,ref:z(Z),role:Q,style:"object"==typeof c?Object.assign({},$,c):$},G(y,Z,_,I)))}C(()=>{"function"==typeof U.current&&void 0!==M&&U.current(w,M,n),N="1"},[w,M,n,U]),C(()=>{X&&b()},[X]);var te=K(x,W(T,m));return E(a,{ref:u,key:N,id:s,role:v,className:l,tabIndex:f,style:"object"==typeof h?F(te,h):te,children:q})}function r(e,t){return t}function n(e){var{scrollTop:i,isScrolling:r}=t(e.offset,e.scrollFps);return o({scrollTop:i,isScrolling:r,positioner:e.positioner,resizeObserver:e.resizeObserver,items:e.items,onRender:e.onRender,as:e.as,id:e.id,className:e.className,style:e.style,role:e.role,tabIndex:e.tabIndex,containerRef:e.containerRef,itemAs:e.itemAs,itemStyle:e.itemStyle,itemHeightEstimate:e.itemHeightEstimate,itemKey:e.itemKey,overscanBy:e.overscanBy,height:e.height,render:e.render})}function a(e,t){void 0===t&&(t=Q);var[i,o]=g({offset:0,width:0});return O(()=>{var{current:t}=e;if(null!==t){var r=0,n=t;do{r+=n.offsetTop||0,n=n.offsetParent}while(n);r===i.offset&&t.offsetWidth===i.width||o({offset:r,width:t.offsetWidth})}},t),i}function s(e){function t(){return r.disconnect()}var o=i(),r=U(e,o);return C(()=>t,[r]),r}function l(e){var t=e.high;e.L===V&&e.R===V?e.max=t:e.L===V?e.max=Math.max(e.R.max,t):e.R===V?e.max=Math.max(e.L.max,t):e.max=Math.max(Math.max(e.L.max,e.R.max),t)}function h(e){for(var t=e;t.P!==V;)l(t.P),t=t.P}function v(e,t){if(t.R!==V){var i=t.R;t.R=i.L,i.L!==V&&(i.L.P=t),i.P=t.P,t.P===V?e.root=i:t===t.P.L?t.P.L=i:t.P.R=i,i.L=t,t.P=i,l(t),l(i)}}function f(e,t){if(t.L!==V){var i=t.L;t.L=i.R,i.R!==V&&(i.R.P=t),i.P=t.P,t.P===V?e.root=i:t===t.P.R?t.P.R=i:t.P.L=i,i.R=t,t.P=i,l(t),l(i)}}function u(e,t,i){t.P===V?e.root=i:t===t.P.L?t.P.L=i:t.P.R=i,i.P=t.P}function d(e,t){var{width:i,columnWidth:o=200,columnGutter:r=0,columnCount:n}=e;void 0===t&&(t=$);var a=()=>{var[e,t]=Z(i,o,r,n);return X(t,e,r)},[s,l]=g(a),h=x(0);return O(()=>{h.current&&l(a()),h.current=1},t),O(()=>{if(h.current){for(var e=s.size(),t=a(),i=0;e>i;i++){var o=s.get(i);t.set(i,void 0!==o?o.height:0)}l(t)}},[i,o,r,n]),s}function c(e,t){var i,{align:o="top",element:r="undefined"!=typeof window&&window,offset:n=0,height:a=("undefined"!=typeof window?window.innerHeight:0)}=t,s=H({positioner:e,element:r,align:o,offset:n,height:a}),l=x(()=>{var e=s.current.element;return e&&"current"in e?e.current:e}).current,[h,v]=y((e,t)=>{var i,o={position:e.position,index:e.index,prevTop:e.prevTop};if("scrollToIndex"===t.type)return{position:s.current.positioner.get(null!==(i=t.value)&&void 0!==i?i:-1),index:t.value,prevTop:void 0};if("setPosition"===t.type)o.position=t.value;else if("setPrevTop"===t.type)o.prevTop=t.value;else if("reset"===t.type)return _;return o},_),f=S(v,15);j(l(),"scroll",()=>{if(!h.position&&h.index){var e=s.current.positioner.get(h.index);e&&v({type:"setPosition",value:e})}});var u=void 0!==h.index&&(null===(i=s.current.positioner.get(h.index))||void 0===i?void 0:i.top);return C(()=>{var e=l();if(e){var{height:t,align:i,offset:o,positioner:r}=s.current;if(h.position){var n=h.position.top;"bottom"===i?n=n-t+h.position.height:"center"===i&&(n-=(t-h.position.height)/2),e.scrollTo(0,Math.max(0,n+=o));var a=0,u=setTimeout(()=>!a&&v({type:"reset"}),400);return()=>{a=1,clearTimeout(u)}}if(void 0!==h.index){var d=r.shortestColumn()/r.size()*h.index;h.prevTop&&(d=Math.max(d,h.prevTop+t)),e.scrollTo(0,d),f({type:"setPrevTop",value:d})}}},[u,h,s,l,f]),x(e=>{v({type:"scrollToIndex",value:e})}).current}function m(e){var t=x(null),i=w({initialWidth:e.ssrWidth,initialHeight:e.ssrHeight}),o=a(t,i),r=Object.assign({offset:o.offset,width:o.width||i[0],height:i[1],containerRef:t},e);r.positioner=d(r),r.resizeObserver=s(r.positioner);var l=c(r.positioner,{height:r.height,offset:o.offset,align:"object"==typeof e.scrollToIndex?e.scrollToIndex.align:void 0}),h=e.scrollToIndex&&("number"==typeof e.scrollToIndex?e.scrollToIndex:e.scrollToIndex.index);return C(()=>{void 0!==h&&l(h)},[h,l]),ee(n,r)}function p(t){return te(m,e({role:"list",columnGutter:t.rowGutter,columnCount:1,columnWidth:1},t))}function P(e,t){void 0===t&&(t=oe);var{isItemLoaded:i,minimumBatchSize:o=16,threshold:r=16,totalItems:n=9e9}=t,a=H(e),s=H(i);return L((e,t,i)=>{for(var l=function(e,t,i,o,r,n){void 0===e&&(e=ie),void 0===t&&(t=16),void 0===o&&(o=9e9);for(var a,s,l=[],h=r;n>=h;h++)e(h,i)?void 0!==a&&void 0!==s&&(l.push(a,s),a=s=void 0):(s=h,void 0===a&&(a=h));if(void 0!==a&&void 0!==s){var v=Math.min(Math.max(s,a+t-1),o-1);for(h=s+1;v>=h&&!e(h,i);h++)s=h;l.push(a,s)}if(l.length)for(var f=l[0],u=l[1];t>u-f+1&&f>0;){var d=f-1;if(e(d,i))break;l[0]=f=d}return l}(s.current,o,i,n,Math.max(0,e-r),Math.min(n-1,(t||0)+r)),h=0;h<l.length-1;++h)a.current(l[h],l[++h],i)},[n,o,r,a,s])}import{useState as g,useRef as x,useEffect as C,createElement as R,useReducer as y,useCallback as L}from"react";import{useWindowSize as w}from"@react-hook/window-size";import M from"@react-hook/window-scroll";import{requestTimeout as b,clearRequestTimeout as z}from"@essentials/request-timeout";import T from"trie-memoize";import I from"@essentials/one-key-map";import k from"@essentials/memoize-one";import H from"@react-hook/latest";import O from"@react-hook/passive-layout-effect";import W from"resize-observer-polyfill";import j from"@react-hook/event";import{useThrottleCallback as S}from"@react-hook/throttle";var A=new Map,B={},E=R,N="0",G=T([I,{},WeakMap,I],(e,t,i,o)=>E(e,{index:t,data:i,width:o})),K=k((e,t)=>({position:"relative",width:"100%",maxWidth:"100%",height:Math.ceil(t),maxHeight:Math.ceil(t),willChange:e?"contents":void 0,pointerEvents:e?"none":void 0})),q=(e,t)=>e[0]===t[0]&&e[1]===t[1],F=k((e,t)=>Object.assign({},e,t),q),D=k(e=>({width:e,zIndex:-1e3,visibility:"hidden",position:"absolute",writingMode:"horizontal-tb"}),(e,t)=>e[0]===t[0]),J=k((e,t)=>i=>o=>{null!==o&&(t&&(t.observe(o),A.set(o,i)),void 0===e.get(i)&&e.set(i,o.offsetHeight))},q),Q=[],U=T([WeakMap],(e,t)=>new W(i=>{for(var o=[],r=0;r<i.length;r++){var n=i[r],a=n.target.offsetHeight;if(a>0){var s=A.get(n.target);if(void 0!==s){var l=e.get(s);void 0!==l&&a!==l.height&&o.push(s,a)}}}o.length>0&&(e.update(o),t(o))})),V={low:0,max:0,high:0,C:2,P:void 0,R:void 0,L:void 0,list:void 0};V.P=V,V.L=V,V.R=V;var X=function(e,t,i){void 0===i&&(i=0);for(var o=function(){var e={root:V,size:0},t={};return{insert(i,o,r){for(var n=e.root,a=V;n!==V&&i!==(a=n).low;)n=i<n.low?n.L:n.R;if(i===a.low&&a!==V){if(!function(e,t,i){for(var o,r=e.list;r;){if(r.index===i)return 0;if(t>r.high)break;o=r,r=r.next}return o||(e.list={index:i,high:t,next:r}),o&&(o.next={index:i,high:t,next:o.next}),1}(a,o,r))return;return a.high=Math.max(a.high,o),l(a),h(a),t[r]=a,void e.size++}var s={low:i,high:o,max:o,C:0,P:a,L:V,R:V,list:{index:r,high:o,next:null}};a===V?e.root=s:(s.low<a.low?a.L=s:a.R=s,h(s)),function(e,t){for(var i;0===t.P.C;)t.P===t.P.P.L?0===(i=t.P.P.R).C?(t.P.C=1,i.C=1,t.P.P.C=0,t=t.P.P):(t===t.P.R&&v(e,t=t.P),t.P.C=1,t.P.P.C=0,f(e,t.P.P)):0===(i=t.P.P.L).C?(t.P.C=1,i.C=1,t.P.P.C=0,t=t.P.P):(t===t.P.L&&f(e,t=t.P),t.P.C=1,t.P.P.C=0,v(e,t.P.P));e.root.C=1}(e,s),t[r]=s,e.size++},remove(i){var o=t[i];if(void 0!==o){delete t[i];var r=function(e,t){var i=e.list;if(i.index===t)return null===i.next?0:(e.list=i.next,1);var o=i;for(i=i.next;null!==i;){if(i.index===t)return o.next=i.next,1;o=i,i=i.next}}(o,i);if(void 0!==r){if(1===r)return o.high=o.list.high,l(o),h(o),void e.size--;var n,a=o,s=a.C;o.L===V?(n=o.R,u(e,o,o.R)):o.R===V?(n=o.L,u(e,o,o.L)):(s=(a=function(e){for(;e.L!==V;)e=e.L;return e}(o.R)).C,n=a.R,a.P===o?n.P=a:(u(e,a,a.R),a.R=o.R,a.R.P=a),u(e,o,a),a.L=o.L,a.L.P=a,a.C=o.C),l(n),h(n),1===s&&function(e,t){for(var i;t!==V&&1===t.C;)t===t.P.L?(0===(i=t.P.R).C&&(i.C=1,t.P.C=0,v(e,t.P),i=t.P.R),1===i.L.C&&1===i.R.C?(i.C=0,t=t.P):(1===i.R.C&&(i.L.C=1,i.C=0,f(e,i),i=t.P.R),i.C=t.P.C,t.P.C=1,i.R.C=1,v(e,t.P),t=e.root)):(0===(i=t.P.L).C&&(i.C=1,t.P.C=0,f(e,t.P),i=t.P.L),1===i.R.C&&1===i.L.C?(i.C=0,t=t.P):(1===i.L.C&&(i.R.C=1,i.C=0,v(e,i),i=t.P.L),i.C=t.P.C,t.P.C=1,i.L.C=1,f(e,t.P),t=e.root));t.C=1}(e,n),e.size--}}},search(t,i,o){for(var r=[e.root];0!==r.length;){var n=r.pop();if(n!==V&&t<=n.max&&(n.L!==V&&r.push(n.L),n.R!==V&&r.push(n.R),n.low<=i&&n.high>=t))for(var a=n.list;null!==a;)a.high<t||o(a.index,n.low),a=a.next}},get size(){return e.size}}}(),r=new Array(e),n=[],a=new Array(e),s=0;e>s;s++)r[s]=0,a[s]=[];return{columnCount:e,columnWidth:t,set:function(e,s){void 0===s&&(s=0);for(var l=0,h=1;h<r.length;h++)r[h]<r[l]&&(l=h);var v=r[l]||0;r[l]=v+s+i,a[l].push(e),n[e]={left:l*(t+i),top:v,height:s,column:l},o.insert(v,v+s,e)},get:e=>n[e],update:t=>{for(var s=new Array(e),l=0,h=0;l<t.length-1;l++){var v=t[l],f=n[v];f.height=t[++l],o.remove(v),o.insert(f.top,f.top+f.height,v),s[f.column]=void 0===s[f.column]?v:Math.min(v,s[f.column])}for(l=0;l<s.length;l++)if(void 0!==s[l]){var u=a[l],d=Y(u,s[l]),c=a[l][d],m=n[c];for(r[l]=m.top+m.height+i,h=d+1;h<u.length;h++){var p=u[h],P=n[p];P.top=r[l],r[l]=P.top+P.height+i,o.remove(p),o.insert(P.top,P.top+P.height,p)}}},range:(e,t,i)=>o.search(e,t,(e,t)=>i(e,n[e].left,t)),estimateHeight:(t,i)=>{var n=Math.max(0,Math.max.apply(null,r));return t===o.size?n:n+Math.ceil((t-o.size)/e)*i},shortestColumn:()=>r.length>1?Math.min.apply(null,r):r[0]||0,size:()=>o.size}},Y=(e,t)=>{for(var i=0,o=e.length-1;o>=i;){var r=i+o>>>1,n=e[r];if(n===t)return r;n>t?o=r-1:i=r+1}return-1},Z=function(e,t,i,o){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=8),o=o||Math.floor(e/(t+i))||1,[Math.floor((e-i*(o-1))/o),o]},$=[],_={index:void 0,position:void 0,prevTop:void 0},ee=R,te=R,ie=(e,t)=>void 0!==t[e],oe={};export{p as List,m as Masonry,n as MasonryScroller,X as createPositioner,U as createResizeObserver,a as useContainerPosition,P as useInfiniteLoader,o as useMasonry,d as usePositioner,s as useResizeObserver,c as useScrollToIndex,t as useScroller};
//# sourceMappingURL=index.mjs.map
